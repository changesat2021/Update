<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bean & Bloom POS - Professional</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --primary: #6F4E37; --food-color: #d35400; --accent: #2c3e50;
            --light: #f8f9fa; --white: #ffffff; --danger: #c0392b;
            --success: #27ae60; --border: #e0e0e0; --radius: 8px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background-color: var(--light); color: var(--accent); padding-bottom: 80px; }
        .container { max-width: 900px; margin: 0 auto; padding: 15px; }
        
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: var(--white); padding: 15px; border-radius: var(--radius); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { color: var(--primary); font-size: 1.2rem; }
        input[type="date"] { border: 1px solid var(--border); padding: 8px; border-radius: 4px; font-weight: bold; }

        .dashboard { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .card { background: var(--white); padding: 12px; border-radius: var(--radius); text-align: center; border: 1px solid var(--border); }
        .card-label { font-size: 0.65rem; color: #777; text-transform: uppercase; font-weight: bold; }
        .card-value { font-size: 1.1rem; font-weight: 800; margin-top: 4px; }
        .card.net { background: var(--accent); color: var(--white); }

        .section-title { font-size: 0.8rem; color: #555; margin: 20px 0 10px 0; border-bottom: 2px solid #ddd; padding-bottom: 5px; text-transform: uppercase; font-weight: bold; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        @media (min-width: 768px) { .menu-grid { grid-template-columns: repeat(4, 1fr); } }

        .menu-btn {
            background: var(--white); border: 1px solid var(--border); border-left: 4px solid var(--primary);
            border-radius: var(--radius); padding: 12px 8px; cursor: pointer; text-align: center;
        }
        .menu-btn.food-btn { border-left-color: var(--food-color); }
        .menu-btn h3 { font-size: 0.85rem; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .menu-btn span { font-size: 0.8rem; font-weight: bold; color: #444; }

        .log-section { background: var(--white); border-radius: var(--radius); margin-top: 20px; border: 1px solid var(--border); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th, td { padding: 12px 10px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f4f4f4; color: #666; font-size: 0.7rem; }
        
        .expense-form { background: #fff; padding: 15px; border-radius: var(--radius); margin-top: 20px; border: 1px dashed #ccc; }
        .form-row { display: flex; gap: 5px; margin-bottom: 10px; }
        input[type="text"], input[type="number"] { padding: 10px; border: 1px solid #ccc; border-radius: 4px; flex: 1; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #fff; padding: 20px; border-radius: 12px; width: 85%; max-width: 300px; text-align: center; }
        .qty-input { width: 100%; font-size: 2rem; text-align: center; margin: 15px 0; border: 2px solid var(--primary); border-radius: 8px; }

        .admin-controls { position: fixed; bottom: 0; width: 100%; max-width: 900px; background: white; border-top: 1px solid #ddd; padding: 10px; display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-ok { background: var(--success); color: white; }
        .btn-payout { background: var(--accent); color: white; }

        @media print {
            header, .menu-grid, .expense-form, .admin-controls, .modal, .btn-del, .section-title, .del-col { display: none !important; }
            .print-header { display: block; text-align: center; border-bottom: 2px solid #000; margin-bottom: 20px; }
            .log-section { border: none; }
            body { background: white; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="print-header" style="display:none;">
        <h1>BEAN & BLOOM COFFEEHOUSE</h1>
        <p id="print-date"></p>
    </div>

    <header class="no-print">
        <h1>☕ Bean & Bloom</h1>
        <div style="display:flex; align-items:center; gap:10px;">
            <button id="auth-btn" onclick="toggleAuth()" style="font-size: 0.7rem; background:none; border:none; text-decoration:underline; cursor:pointer;">Admin Login</button>
            <input type="date" id="work-date">
        </div>
    </header>

    <div class="dashboard">
        <div class="card"><div class="card-label">Sales</div><div class="card-value" style="color:var(--success)" id="total-sales">0</div></div>
        <div class="card"><div class="card-label">Expenses</div><div class="card-value" style="color:var(--danger)" id="total-expenses">0</div></div>
        <div class="card net"><div class="card-label">Net Cash</div><div class="card-value" id="net-cash">0</div></div>
    </div>

    <div id="menu-container" class="no-print">
        <div class="section-title">Hot Drinks</div><div id="hot" class="menu-grid"></div>
        <div class="section-title">Cold Drinks</div><div id="cold" class="menu-grid"></div>
        <div class="section-title">Special Juices</div><div id="special" class="menu-grid"></div>
        <div class="section-title">Fasting Foods</div><div id="fasting" class="menu-grid"></div>
        <div class="section-title">Non-Fasting Foods</div><div id="nonfast" class="menu-grid"></div>
    </div>

    <div class="expense-form no-print">
        <div class="form-row">
            <input type="text" id="exp-name" placeholder="Expense Name">
            <input type="number" id="exp-price" placeholder="Amount" inputmode="numeric">
        </div>
        <button class="btn btn-payout" style="width:100%" onclick="addExpense()">Record Payout</button>
    </div>

    <div class="log-section">
        <table>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Qty</th>
                    <th>Price</th>
                    <th class="del-col">X</th>
                </tr>
            </thead>
            <tbody id="log-body"></tbody>
        </table>
    </div>

    <div class="admin-controls no-print">
        <button id="payout-btn" class="btn btn-payout" onclick="printReport()" style="display:none;">Print Daily Payout</button>
    </div>
</div>

<div id="qty-modal" class="modal">
    <div class="modal-content">
        <h3 id="modal-item-name">Item</h3>
        <input type="number" id="qty-input" class="qty-input" value="1">
        <div style="display:flex; gap:10px;">
            <button class="btn" style="background:#eee" onclick="closeModal()">Cancel</button>
            <button class="btn btn-ok" onclick="submitSale()">Add Sale</button>
        </div>
    </div>
</div>

<script>
    // --- FIREBASE CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyAKqsixs_luzjqCY1ZCqrKRtn77wcJs5Iw",
        authDomain: "bean-5a113.firebaseapp.com",
        projectId: "bean-5a113",
        storageBucket: "bean-5a113.firebasestorage.app",
        messagingSenderId: "702927377502",
        appId: "1:702927377502:web:9e50192a0c431da69850cf"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const MENU = [
        { name: 'ቡና', price: 40, cat: 'hot' }, { name: 'ሻይ', price: 25, cat: 'hot' }, { name: 'ወተት', price: 70, cat: 'hot' }, { name: 'ማኪያቶ', price: 60, cat: 'hot' }, { name: 'ቀሽር', price: 50, cat: 'hot' }, { name: 'ስፕሪስ', price: 50, cat: 'hot' },
        { name: 'ለስላሳ', price: 50, cat: 'cold' }, { name: 'ውሃ 2L', price: 40, cat: 'cold' }, { name: 'ውሃ 1L', price: 35, cat: 'cold' }, { name: 'ውሃ 0.5L', price: 25, cat: 'cold' },
        { name: 'አቮካዶ ጁስ', price: 120, cat: 'special' }, { name: 'ማንጎ ጁስ', price: 120, cat: 'special' }, { name: 'ፓፓያ ጁስ', price: 120, cat: 'special' }, { name: 'ስፔሻል ጁስ', price: 250, cat: 'special' },
        { name: 'ፓስታ በስጎ', price: 130, cat: 'fasting' }, { name: 'ሽሮ', price: 120, cat: 'fasting' }, { name: 'ተጋቢኖ', price: 130, cat: 'fasting' }, { name: 'በያይነት', price: 140, cat: 'fasting' }, { name: 'ቺፕስ 80', price: 80, cat: 'fasting' },
        { name: 'ጥብስ', price: 270, cat: 'nonfast' }, { name: 'ስጋ ፍርፍር', price: 250, cat: 'nonfast' }, { name: 'እንቁላል ሳንድዊች', price: 120, cat: 'nonfast' }, { name: 'እንቁላል ፍርፍር', price: 140, cat: 'nonfast' }
    ];

    let selectedItem = null;
    let isAdmin = false;

    window.onload = () => {
        document.getElementById('work-date').value = new Date().toISOString().split('T')[0];
        document.getElementById('work-date').onchange = loadDay;
        renderMenu();
        loadDay();
        
        auth.onAuthStateChanged(user => {
            isAdmin = !!user;
            document.getElementById('auth-btn').innerText = isAdmin ? "Logout Admin" : "Admin Login";
            document.getElementById('payout-btn').style.display = isAdmin ? 'block' : 'none';
            loadDay(); 
        });
    };

    function renderMenu() {
        MENU.forEach(item => {
            const btn = document.createElement('div');
            btn.className = `menu-btn ${['fasting','nonfast'].includes(item.cat) ? 'food-btn' : ''}`;
            btn.innerHTML = `<h3>${item.name}</h3><span>${item.price} ETB</span>`;
            btn.onclick = () => {
                selectedItem = item;
                document.getElementById('modal-item-name').innerText = item.name;
                document.getElementById('qty-modal').style.display = 'flex';
            };
            document.getElementById(item.cat).appendChild(btn);
        });
    }

    async function submitSale() {
        const qty = parseInt(document.getElementById('qty-input').value);
        const date = document.getElementById('work-date').value;
        if(!qty) return;
        await db.collection('transactions').add({
            n: selectedItem.name, q: qty, p: selectedItem.price * qty, d: date, ex: false, ts: Date.now()
        });
        closeModal();
    }

    async function addExpense() {
        const name = document.getElementById('exp-name').value;
        const price = document.getElementById('exp-price').value;
        const date = document.getElementById('work-date').value;
        if(!name || !price) return;
        await db.collection('transactions').add({
            n: "EXP: " + name, q: 1, p: parseFloat(price), d: date, ex: true, ts: Date.now()
        });
        document.getElementById('exp-name').value = ''; document.getElementById('exp-price').value = '';
    }

    function loadDay() {
        const date = document.getElementById('work-date').value;
        db.collection('transactions').where('d', '==', date).orderBy('ts', 'desc').onSnapshot(snap => {
            let sales = 0, exps = 0;
            const body = document.getElementById('log-body');
            body.innerHTML = '';

            snap.forEach(doc => {
                const t = doc.data();
                if(t.ex) exps += t.p; else sales += t.p;
                
                const tr = document.createElement('tr');
                const delBtn = isAdmin ? `<button onclick="deleteRow('${doc.id}')" style="color:red; background:none; border:none; font-weight:bold;">X</button>` : '';
                tr.innerHTML = `
                    <td style="color:${t.ex?'red':'black'}">${t.n}</td>
                    <td>${t.q}</td>
                    <td>${t.p}</td>
                    <td class="del-col">${delBtn}</td>
                `;
                body.appendChild(tr);
            });

            document.getElementById('total-sales').innerText = sales;
            document.getElementById('total-expenses').innerText = exps;
            document.getElementById('net-cash').innerText = (sales - exps);
        });
    }

    async function deleteRow(id) {
        if(!isAdmin) return;
        if(confirm("Admin: Permanently delete this record?")) {
            await db.collection('transactions').doc(id).delete();
        }
    }

    async function toggleAuth() {
        if(auth.currentUser) { auth.signOut(); }
        else {
            const email = prompt("Admin Email:"), pass = prompt("Password:");
            if(email && pass) await auth.signInWithEmailAndPassword(email, pass).catch(e => alert(e.message));
        }
    }

    function printReport() {
        document.getElementById('print-date').innerText = "Date: " + document.getElementById('work-date').value;
        window.print();
    }

    function closeModal() { document.getElementById('qty-modal').style.display = 'none'; }
</script>
</body>
</html>
