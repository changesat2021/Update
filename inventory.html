<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bean & Bloom - Inventory</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        :root { --primary: #6F4E37; --white: #fff; --radius: 10px; }
        body { margin: 0; font-family: sans-serif; background: #f4f4f4; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        
        header { background: var(--white); padding: 15px; border-radius: var(--radius); display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        h2 { margin: 0; color: var(--primary); }
        
        /* Stock Cards */
        .stock-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .stock-card { background: white; padding: 20px; border-radius: var(--radius); box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 5px solid #ccc; position: relative; }
        .stock-card.low { border-left-color: red; }
        .stock-card.good { border-left-color: green; }
        
        .stock-name { font-weight: bold; font-size: 1.1rem; display: block; margin-bottom: 5px; }
        .stock-val { font-size: 1.5rem; font-weight: 800; color: #333; }
        .unit { font-size: 0.8rem; color: #777; }

        /* Add Stock Form */
        .controls { background: white; padding: 15px; border-radius: var(--radius); margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 5px; flex: 1; }
        button { padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { opacity: 0.9; }
        .back-btn { background: #555; text-decoration: none; display: inline-block; color: white; padding: 10px 20px; border-radius: 5px; margin-bottom: 10px;}
    </style>
</head>
<body>

<div class="container">
    <a href="index.html" class="back-btn">‚Üê Back to POS</a>
    
    <header>
        <h2>üì¶ Stock Inventory</h2>
        <div id="auth-status"></div>
    </header>

    <div class="controls">
        <input type="text" id="ing-name" placeholder="Ingredient Name (e.g., ·â°·äì ·çç·à¨)">
        <input type="number" id="ing-qty" placeholder="Amount to Add (KG/L)" step="0.01">
        <button onclick="addStock()">+ Add to Stock</button>
    </div>

    <div id="inventory-grid" class="stock-grid">
        <p>Loading inventory...</p>
    </div>
</div>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyAKqsixs_luzjqCY1ZCqrKRtn77wcJs5Iw", 
        authDomain: "bean-5a113.firebaseapp.com", 
        projectId: "bean-5a113", 
        storageBucket: "bean-5a113.firebasestorage.app", 
        messagingSenderId: "702927377502", 
        appId: "1:702927377502:web:9e50192a0c431da69850cf" 
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Load Inventory Real-time
    db.collection('inventory').onSnapshot(snap => {
        const grid = document.getElementById('inventory-grid');
        grid.innerHTML = '';
        
        snap.forEach(doc => {
            const data = doc.data();
            const div = document.createElement('div');
            // If stock < 5, highlight red (low)
            div.className = `stock-card ${data.q < 5 ? 'low' : 'good'}`;
            
            div.innerHTML = `
                <span class="stock-name">${doc.id}</span>
                <span class="stock-val">${data.q.toFixed(2)}</span>
                <span class="unit">KG / Liters</span>
                <div style="margin-top:10px; font-size:0.8rem; color:#888;">
                   Last update: ${new Date(data.ts).toLocaleDateString()}
                </div>
            `;
            grid.appendChild(div);
        });
        
        if(snap.empty) grid.innerHTML = '<p>No ingredients found. Add one above.</p>';
    });

    async function addStock() {
        const name = document.getElementById('ing-name').value.trim();
        const qty = parseFloat(document.getElementById('ing-qty').value);

        if(!name || !qty) return alert("Please enter name and quantity");

        const ref = db.collection('inventory').doc(name);
        
        // Use Firebase Increment to atomatically add to existing value
        await ref.set({
            q: firebase.firestore.FieldValue.increment(qty),
            ts: Date.now()
        }, { merge: true });

        alert(`${qty} added to ${name}`);
        document.getElementById('ing-name').value = '';
        document.getElementById('ing-qty').value = '';
    }
</script>
</body>
</html>
